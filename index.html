<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Redireccionando Banpro...</title>
  <style>
    /* Estilos se mantienen igual */
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const params = new URLSearchParams(window.location.search);
      const deepLink = params.get('deepLink');
      
      // Validación actualizada con tu scheme
      if (!deepLink || !deepLink.startsWith('com.banprogrupopromerica.ni.bancadigital.uat://')) {
        showError('Enlace inválido');
        return;
      }

      const ua = navigator.userAgent;
      const isAndroid = /android/i.test(ua);
      const isIOS = /iphone|ipad|ipod/i.test(ua);
      
      const androidStore = "https://play.google.com/store/apps/details?id=com.banprogrupopromerica.ni.bancadigital.prod";
      const iosStore = "https://apps.apple.com/us/app/banca-m%C3%B3vil-banpro/id1548537395";
      
      // Intentar abrir app
      tryOpenApp(deepLink);
      
      // Configurar timeout para tienda
      const storeTimeout = setTimeout(() => {
        redirectToStore(isAndroid ? androidStore : iosStore);
      }, 1500);

      // Detectar si la app se abrió
      window.addEventListener('blur', () => clearTimeout(storeTimeout));
      window.addEventListener('pagehide', () => clearTimeout(storeTimeout));
      
      // Método alternativo para iOS
      if (isIOS) {
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = deepLink;
        document.body.appendChild(iframe);
        setTimeout(() => iframe.remove(), 100);
      }
    });

    function tryOpenApp(deepLink) {
      window.location.href = deepLink;
    }

    function redirectToStore(storeUrl) {
      window.location.href = storeUrl;
    }

    function showError(message) {
      document.querySelector('h1').textContent = message;
      document.querySelector('.loader').style.display = 'none';
      document.querySelector('.store-button').style.display = 'block';
    }
  </script>
</head>
<body>
  <div class="loader"></div>
  <h1>Redirigiendo a Banpro...</h1>
  <p>Por favor espera unos segundos</p>
  <a href="#" class="store-button" onclick="handleStoreRedirect()">Descargar App</a>

  <script>
    function handleStoreRedirect() {
      const ua = navigator.userAgent;
      const isAndroid = /android/i.test(ua);
      window.location.href = isAndroid ? 
        "https://play.google.com/store/apps/details?id=com.banprogrupopromerica.ni.bancadigital.prod" : 
        "https://apps.apple.com/us/app/banca-m%C3%B3vil-banpro/id1548537395";
    }
    
    setTimeout(() => {
      document.querySelector('.store-button').style.display = 'block';
    }, 3000);
  </script>
</body>
</html>